<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Duolingo Super — сервис активации</title>
<style>
:root{
  --bg1:#0f172a; --bg2:#0b2559; --text:#e5e7eb; --muted:#9ba3af;
  --accent:#2563eb; --accent2:#1d4ed8; --panel:#111928;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
  color:var(--text);
  background:
    radial-gradient(1200px 600px at 20% -10%, rgba(18,40,80,.55), rgba(6,14,28,.6) 35%, rgba(0,0,0,0) 60%),
    linear-gradient(160deg, rgba(15,23,42,.78), rgba(11,37,89,.78)),
    url("/assets/img/bg.jpg") center / cover no-repeat fixed;
}
@media (max-width:900px){ body{ background-attachment: scroll; } }

.container{max-width:1100px;margin:0 auto;padding:28px}
.header{position:relative;display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;gap:16px}

/* 左上：LOGO + 文本 */
.brand{display:flex;align-items:center;gap:12px}
.logo{
  height: clamp(26px, 3.2vw, 42px);
  width:auto; object-fit:contain; border-radius:8px;
  box-shadow:0 6px 16px rgba(0,0,0,.28);
}
/* E版：字号从34px→30px */
.brand-title{font-weight:800;font-size:30px;line-height:1.2}

/* 右上：联系客服按钮 + 下拉二维码 */
.support{position:relative}
.btn{display:inline-flex;align-items:center;justify-content:center;padding:12px 18px;border-radius:12px;
  background:var(--accent);color:#fff;font-weight:600;border:0;cursor:pointer;transition:.15s}
.btn:hover{background:var(--accent2)}
.btn:disabled{opacity:.7;cursor:not-allowed}

/* 下拉面板（二维码） */
.qr-panel{
  position:absolute; right:0; top:calc(100% + 10px);
  width:min(270px, 75vw); z-index:50;
  background:rgba(17,25,40,.96);
  border:1px solid rgba(255,255,255,.08); border-radius:14px;
  box-shadow:0 12px 28px rgba(0,0,0,.35);
  padding:14px; opacity:0; transform:translateY(-8px); pointer-events:none;
  transition:opacity .18s ease, transform .18s ease;
}
.qr-panel::before{
  content:""; position:absolute; right:18px; top:-7px; width:12px; height:12px;
  background:rgba(17,25,40,.96); border:1px solid rgba(255,255,255,.08);
  transform:rotate(45deg); border-right:none; border-bottom:none;
}
.qr-panel.open{opacity:1; transform:translateY(0); pointer-events:auto}
.qr-img{width:100%; height:auto; display:block; border-radius:10px}
.qr-note{margin-top:8px; font-size:13px; color:var(--muted); text-align:center}

/* 表单与卡片 */
.grid{display:grid;gap:24px}
@media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
.card{
  background:rgba(17,25,40,.75); backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:24px
}
.card h2{margin:0 0 18px}
label{display:block;margin:6px 0;color:var(--muted);font-size:14px}
.input{width:100%;padding:14px 16px;border-radius:12px;border:1px solid rgba(255,255,255,.12);
  background:#0a1020;color:var(--text);outline:none}
.input:focus{border-color:rgba(99,102,241,.7);box-shadow:0 0 0 3px rgba(99,102,241,.25)}
.actions{margin-top:14px}
.note{color:var(--muted);font-size:13px;margin-top:12px}

/* 蓝色问号“帮助”按钮 */
.help{
  display:inline-flex;align-items:center;justify-content:center;
  width:18px;height:18px;margin-left:6px;border-radius:50%;
  border:1px solid currentColor;color:var(--accent);
  font-weight:800;text-decoration:none;line-height:1;transform:translateY(-1px);
}
.help:hover{filter:brightness(1.2)}
.help:focus-visible{outline:2px solid var(--accent2);outline-offset:2px}

.footer{margin-top:20px;text-align:center;color:var(--muted);font-size:12px}

/* 弹窗 */
.modal-backdrop{position:fixed;inset:0;background:rgba(2,8,23,.55);backdrop-filter:blur(2px);display:none;align-items:center;justify-content:center;z-index:9999}
.modal{width:min(560px,92vw);background:rgba(17,25,40,.96);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:20px}
.modal-title{font-size:18px;font-weight:700;margin:2px 0 10px}
.modal-body{color:var(--text);line-height:1.55;white-space:pre-wrap}
.modal-actions{margin-top:16px;text-align:right}
.badge-ok{color:#22c55e}
.badge-err{color:#f87171}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <!-- 左：LOGO + 文本（E版标题文字已替换） -->
    <div class="brand">
      <img src="/assets/img/logo.jpg" alt="Duolingo Super" class="logo">
      <span class="brand-title">Duolingo Super — сервис активации</span>
    </div>

    <!-- 右：联系客服按钮 + 下拉二维码 -->
    <div class="support">
      <button class="btn" type="button" id="btnSupport" aria-expanded="false" aria-controls="qrPanel">
        Связаться с поддержкой
      </button>
      <div class="qr-panel" id="qrPanel" role="region" aria-label="QR-код для связи с поддержкой">
        <img src="/assets/img/QRcode.jpg" alt="QR-код поддержки" class="qr-img">
        <div class="qr-note">Сканируйте QR-код, чтобы связаться с поддержкой</div>
      </div>
    </div>
  </div>

  <!-- E版：H1 字号从34px→30px -->
  <h1 style="margin:0 0 18px;font-size:30px;line-height:1.2">
    Быстрая активация и проверка ваучера
  </h1>

  <div class="grid">
    <div class="card">
      <h2>Активация подписки</h2>
      <form id="form-activate" action="https://waiyu.pro/app/submitOrder" method="post" target="_blank" autocomplete="on">
        <label for="email">
          Почта, привязанная к Duolingo
          <a href="/help-email.html"
             class="help"
             title="Как найти почту Duolingo?"
             target="_blank" rel="noopener"
             aria-label="Как найти почту Duolingo?">?</a>
        </label>
        <input id="email" name="email" type="email" required class="input" placeholder="name@example.com">

        <label for="code" style="margin-top:12px">Код активации (ваучер)</label>
        <input id="code" name="couponCode" required class="input" placeholder="Введите код">

        <div class="actions">
          <button class="btn" type="submit">Активировать</button>
        </div>

        <div class="note">Если окно с результатом не открылось — разрешите всплывающие окна в браузере.</div>
      </form>
    </div>

    <div class="card">
      <h2>Проверка срока действия</h2>
      <form id="form-check" action="https://waiyu.pro/app/queryExpireTime" method="post" target="_blank">
        <label for="check">Код активации</label>
        <input id="check" name="couponCode" required class="input" placeholder="Введите код для проверки">

        <div class="actions">
          <button class="btn" type="submit">Проверить</button>
        </div>

        <div class="note">Результат откроется в новой вкладке.</div>
      </form>
    </div>
  </div>

  <div class="footer">© 2019–2025. Этот сайт использует общедоступные конечные точки для обработки запросов.</div>
</div>

<!-- 弹窗 -->
<div class="modal-backdrop" id="dlg">
  <div class="modal">
    <div class="modal-title" id="dlgTitle">Сообщение</div>
    <div class="modal-body" id="dlgBody"></div>
    <div class="modal-actions">
      <button class="btn" type="button" id="dlgOk">Понятно</button>
    </div>
  </div>
</div>

<script>
/* 右上角支持按钮：切换下拉二维码，点击外部区域自动关闭 */
(function(){
  const btn = document.getElementById('btnSupport');
  const panel = document.getElementById('qrPanel');
  function close(){ panel.classList.remove('open'); btn.setAttribute('aria-expanded','false'); }
  function toggle(e){
    e.stopPropagation();
    const open = panel.classList.toggle('open');
    btn.setAttribute('aria-expanded', open ? 'true' : 'false');
  }
  btn.addEventListener('click', toggle);
  document.addEventListener('click', (e)=>{
    if (!panel.contains(e.target) && !btn.contains(e.target)) close();
  }, {passive:true});
  window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') close(); });
})();

/** 中文 → 俄文 翻译（先精确匹配，再包含替换） */
function translateZhToRu(raw) {
  if (!raw) return raw;
  const exact = {
    "系统未知异常": "Системная неизвестная ошибка",
    "未知异常！请联系管理员处理！": "Неизвестная ошибка. Обратитесь к администратору.",
    "充值成功": "Активация прошла успешно",
    "激活成功": "Активация прошла успешно",
    "订单提交成功": "Заявка успешно отправлена",
    "无效的激活码": "Недействительный код активации",
    "券码不存在或已使用": "Код не существует или уже использован",
    "参数错误": "Неверные параметры запроса",
    "验证码错误": "Неверный проверочный код",
    "余额不足": "Недостаточно средств",
    "请求过于频繁": "Слишком частые请求",
    "服务器繁忙": "Сервер перегружен. Повторите позже",
    "失败": "Не удалось",
    "成功": "Успешно"
  };
  if (exact[raw]) return exact[raw];

  const contains = [
    ["未知异常", "Неизвестная ошибка"],
    ["成功", "успешно"],
    ["失败", "не удалось"],
    ["错误", "ошибка"],
    ["不存在", "не существует"],
    ["已使用", "уже использован"],
    ["频繁", "слишком часто"],
    ["繁忙", "перегружен"]
  ];

  let msg = String(raw);
  for (const [zh, ru] of contains) {
    if (msg.includes(zh)) msg = msg.replaceAll(zh, ru);
  }
  return msg;
}

/* 弹窗 UI */
const dlg = document.getElementById('dlg');
const dlgTitle = document.getElementById('dlgTitle');
const dlgBody = document.getElementById('dlgBody');
const dlgOk = document.getElementById('dlgOk');
dlgOk.addEventListener('click', () => dlg.style.display = 'none');

function showModal(msg, ok) {
  dlgTitle.innerHTML = ok
    ? '<span class="badge-ok">Готово</span>'
    : '<span class="badge-err">Ошибка отправки</span>';
  dlgBody.textContent = msg;
  dlg.style.display = 'flex';
}

/* 拦截两个表单，AJAX 提交并在本页弹窗显示结果 */
function bindAjax(formId) {
  const form = document.getElementById(formId);
  const btn = form.querySelector('button[type="submit"]');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const oldText = btn.textContent;
    btn.disabled = true;
    btn.textContent = 'Отправка…';

    try {
      const body = new URLSearchParams(new FormData(form)).toString();
      const resp = await fetch(form.action, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
        body
      });

      let data, txt;
      try { data = await resp.json(); }
      catch { txt = await resp.text(); }

      const code = (data && (data.code ?? data.status)) ?? (resp.ok ? 200 : 500);
      let msg = (data && (data.msg || data.message || data.data))
                || txt
                || (resp.ok ? 'Успешно' : 'Неизвестная ошибка');

      msg = translateZhToRu(msg);

      const isOk = Number(code) === 200 || Number(code) === 0 || /успех|успеш/i.test(msg);
      showModal(msg, isOk);

    } catch (err) {
      showModal('Сетевая ошибка. Повторите позже.', false);
    } finally {
      btn.disabled = false;
      btn.textContent = oldText;
    }
  });
}
bindAjax('form-activate');
bindAjax('form-check');
</script>
</body>
</html>
